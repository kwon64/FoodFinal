<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="friendDAO">

	<!-- 예약률 상위3개 마커찍기 -->
	<select id="test" resultType="store">
	SELECT * 
	
		FROM (
			SELECT ROWNUM cnt, A.* 
				FROM (
						select r.r_store_name as s_brand_name ,s.s_address as s_address ,count(*) as count
                        from  reservation r, store s 
                        where r.r_store_name = s.s_brand_name 
                        group by r.r_store_name, s.s_address
                        order by count desc
						) A
				)
		WHERE cnt BETWEEN 1 AND 3
	
	</select>
	
	<!-- 전체매장갯수 -->
	<select id="allcount" resultType="int">
		select count(*) from store
	</select>
	
	<!-- 검색된 갯수 -->
	<select id="searchCount" parameterType="hashmap" resultType="int"> 
		SELECT COUNT(*) FROM store
	<where>
		<if test='searchType!=null &amp;&amp; keyword!=null'>
		S_CATEGORY = ${searchType}
		AND
		S_BRAND_NAME like '%'||#{keyword}||'%'
		</if>
	</where>
	</select>
	
	<!-- 검색한 결과 list로 보내주기 -->
	<select id="selectStorelist" parameterType="hashmap" resultType="store">
	SELECT * 
		FROM (
			SELECT ROWNUM RN, A.* 
				FROM (
						SELECT * 
						FROM store 
						<where>
							<if test='searchType!=null &amp;&amp; keyword!=null'>
                            S_CATEGORY = #{searchType}
                            AND
                            S_BRAND_NAME like '%'||#{keyword}||'%'
                            </if>
						</where>
						ORDER BY ROWNUM DESC 
						) A
				)
	WHERE RN BETWEEN #{start} AND #{end}
	</select>


</mapper>